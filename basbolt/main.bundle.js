(()=>{"use strict";var e,n={6075:(e,n,t)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.updateAsm=i,n.compile=function(e){return async(n,t,{compiler:r})=>{const s=await r.compile(e);if(!s.canceled&&s.lst){n(i((0,o.default)(s.lst)))}}};var r,o=(r=t(6318))&&r.__esModule?r:{default:r},s=t(9397);function i(e){return{type:s.UPDATE_ASM,asm:e}}},9397:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.UPDATE_ASM=void 0;n.UPDATE_ASM="UPDATE_ASM"},8077:(e,n,t)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){const e=(0,r.useSelector)((({asm:e})=>e)),[n,t]=(0,o.useState)(!1),l=(0,o.useRef)(null),u=(0,o.useRef)([]);(0,o.useEffect)((()=>{if(!l.current)return;const{editor:n,monaco:t}=l.current,r=u.current,o=function(e,n){if(!e||e.errors.length>0)return[];let t=0,r=1;return e.blocks.flatMap((e=>{if(0==e.asm.length)return[];const o=new n(r,1,r+e.asm.length-1,1);return r+=e.asm.length,[{range:o,options:{isWholeLine:!0,className:"blockColor"+t++%10}}]}))}(e,t.Range);(r.length>0||o.length>0)&&(u.current=n.deltaDecorations(r,o))}),[e,n]);const{language:c,value:d}=function(e){return null===e?{language:"text/plain",value:"No assembly generated"}:e.errors.length>0?{language:"text/plain",value:e.errors.map((e=>`At line ${e.line}, column ${e.column}: ${e.message}`)).join("\n")}:{language:"intelasm",value:e.blocks.map((e=>e.asm.map((e=>e.text)).join("\n"))).join("\n")}}(e);return(0,s.jsx)(i,{theme:"vs-light",options:a,language:c,value:d,onMount:(e,n)=>{l.current={editor:e,monaco:n},t(!0)}})};var r=t(8216),o=t(7363),s=t(5893);const i=monaco_react.default,a={selectOnLineNumbers:!0,automaticLayout:!0,readOnly:!0}},2284:(e,n,t)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({parentDomNode:e,defaultSource:n}){const t=(0,r.useDispatch)(),u=(0,r.useSelector)((({asm:e})=>e)),c=(0,o.useRef)(null),d=(0,o.useRef)([]),[f,h]=(0,o.useState)(!1);(0,o.useEffect)((()=>{t((0,s.compile)(n))}),[]),(0,o.useEffect)((()=>{if(!c.current)return;const{editor:e,monaco:n}=c.current,t=d.current,r=function(e,n){if(!e||e.errors.length>0)return[];let t=0;return e.blocks.flatMap((e=>{if(0==e.asm.length)return[];const[r,o]=e.lines;return[{range:new n(r,1,o,1),options:{isWholeLine:!0,className:"blockColor"+t++%10}}]}))}(u,n.Range);(t.length>0||r.length>0)&&(d.current=e.deltaDecorations(t,r));const o=e.getModel(),s=l(u);n.editor.setModelMarkers(o,"BC",s)}),[u,f]);const m={selectOnLineNumbers:!0,automaticLayout:!0,fixedOverflowWidgets:!0,overflowWidgetsDomNode:document.body};return(0,i.jsx)(a,{theme:"vs-light",options:m,defaultValue:n,onChange:e=>t((0,s.compile)(e)),onMount:(e,t)=>{c.current={editor:e,monaco:t},h(!0);const r=t.editor.createModel(n,"vb");r.setEOL(1),e.setModel(r);for(const e of document.getElementsByTagName("style"))e.innerHTML.includes(".monaco-editor .monaco-hover")&&(e.innerHTML=e.innerHTML.replaceAll(".monaco-editor .monaco-hover",".monaco-hover")),e.innerHTML.includes(".monaco-editor .monaco-editor-overlay-message")&&(e.innerHTML=e.innerHTML.replaceAll(".monaco-editor .monaco-editor-overlay-message",".monaco-hover"))}})};var r=t(8216),o=t(7363),s=t(6075),i=t(5893);const a=monaco_react.default;function l(e){return null===e?[]:e.errors.map((e=>({startLineNumber:e.line,startColumn:e.column,endLineNumber:e.line,endColumn:e.column,message:e.message,severity:monaco.MarkerSeverity.Error})))}},566:(e,n,t)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){const[e,n]=(0,i.useState)(u),t=(0,i.useRef)(null);(0,i.useEffect)((()=>{t.current=document.getElementById("editor")}));return(0,a.jsx)(s.default,{loadTab:({id:e})=>{switch(e){case"files":return{id:e,title:"files",content:(0,a.jsx)("div",{children:"Hello"})};case"editor":return{id:e,cached:!0,title:"editor",content:(0,a.jsx)(r.default,{parentDomNode:t.current,defaultSource:'PRINT "HELLO WORLD!"'})};case"asm":return{id:e,title:"asm",content:(0,a.jsx)(o.default,{})}}},layout:e,dropMode:"edge",onLayoutChange:e=>{n(e)}})};var r=l(t(2284)),o=l(t(8077)),s=l(t(1807)),i=t(7363);t(5157);var a=t(5893);function l(e){return e&&e.__esModule?e:{default:e}}const u={dockbox:{mode:"horizontal",children:[{tabs:[{id:"editor"}]},{tabs:[{id:"asm"}]}]}}},3057:(e,n,t)=>{var r=d(t(1533)),o=t(8216),s=t(4890),i=d(t(3894)),a=d(t(566)),l=d(t(7e3)),u=d(t(7263));t(4530);var c=t(5893);function d(e){return e&&e.__esModule?e:{default:e}}addEventListener("load",(()=>{const e=new l.default(document),n=(0,s.createStore)(u.default,(0,s.applyMiddleware)(i.default.withExtraArgument({compiler:e})));r.default.render((0,c.jsx)(o.Provider,{store:n,children:(0,c.jsx)(a.default,{})}),document.getElementById("root"))}))},7263:(e,n,t)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;t(9397);const r={asm:null};n.default=(e=r,n)=>"UPDATE_ASM"===n.type?{...e,asm:n.asm}:e},7e3:(e,n,t)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=t(5618);class o{constructor(){this.buffer="",this.sentinel="",this.numChars=-1,this.resolver=()=>{},this.pending=Promise.resolve()}acceptChar(e){this.buffer+=e,(this.numChars>0&&0==--this.numChars||this.sentinel.length>0&&this.buffer.endsWith(this.sentinel))&&(this.resolver(this.buffer),this.buffer="")}queue(e,n,t=null){return this._queue(e,n,-1,t)}queueFixedResponse(e,n,t=null){return this._queue(e,"",n,t)}_queue(e,n,t,r){return this.pending=new Promise((r=>this.pending.finally((()=>{this.sentinel=n,this.numChars=t,this.resolver=r,e()})))),null!==r&&(this.pending=this.pending.then(r)),this.pending}}class s{constructor(){this.pending={promise:Promise.resolve(),tryCancel:!1}}queue(e){this.pending.tryCancel=!0;const n=this.pending={tryCancel:!1,promise:(()=>{const t=()=>n.tryCancel?{canceled:!0}:e();return this.pending.promise.then(t,t)})()};return n.promise}}n.default=class{constructor(e){this.container=e.createElement("div");const n=e.createElement("div");n.style.cssText="white-space: pre; font: 14px monospace; line-height: 14px",this.container.appendChild(n);const t=e.createElement("canvas");t.style.display="none",this.container.appendChild(t),e.body.appendChild(this.container),this.emulator=new V86Starter({memory_size:33554432,vga_memory_size:2097152,screen_container:this.container,bios:{url:"seabios.bin"},vga_bios:{url:"vgabios.bin"},hda:{url:"basbolt.img",async:!0},autostart:!0}),this.serial=new o,this.emulator.add_listener("serial0-output-char",(e=>{this.serial.acceptChar(e)})),this.serial.queue((()=>{}),"ready\r\n",(e=>{const n=/\(buffer (\d+), size (\d+)\)/g.exec(e);if(null===n)throw new Error(`expected buffer address, found ${JSON.stringify(e)}`);const t=Number(n[1]),r=Number(n[2]);this.bufferAddress=t,this.bufferSize=r})),this.compileQueue=new s}async _sendCommands(e){await this.serial.queue((()=>{const n=`${e.join("\r\n")}\r\nECHO (err %ERRORLEVEL%) ready>COM1\r\n`;this.emulator.serial0_send(n)}),"ready\r\n")}writeBuffer(e){this.emulator.write_memory(e,this.bufferAddress)}readBuffer(){return this.emulator.read_memory(this.bufferAddress,this.bufferSize)}compile(e){return 0===e.length?{lines:[],blocks:[],errors:[]}:this.compileQueue.queue((async()=>{await this.serial.queue((()=>{this.emulator.serial0_send(`compile\nC:\\JOB.BAS\n${e.length}\n`)}),"ready\r\n");const n=(0,r.encode)(e);for(let e=0;e<n.length;e+=this.bufferSize){const t=n.length-e,r=Math.min(t,this.bufferSize);this.writeBuffer(n.subarray(e,e+r));const o=t>this.bufferSize?"ready\r\n":"received\r\n";await this.serial.queue((()=>{this.emulator.serial0_send("a")}),o)}const t=await this.serial.queue((()=>{}),"done\r\nready\r\n"),o=/\(size (\d+)\)/g.exec(t);if(null===o)throw new Error(`Unexpected output: '${t}'`);const s=new Uint8Array(Number(o[1]));for(let e=0;e<s.length;e+=this.bufferSize){const n=s.length-e,t=Math.min(n,this.bufferSize);s.set(this.readBuffer().subarray(0,t),e),await this.serial.queue((()=>{this.emulator.serial0_send("a")}),"ready\r\n")}return{lst:(0,r.decode)(s)}}))}close(){this.emulator.exit()}}},5618:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.encode=function(e){const n=new Uint8Array(e.length);let t=0;for(const o of e){const e=o.charCodeAt(0);if(e<127)n[t]=e;else{const s=r[o];if(void 0===s)throw new Error(`cannot encode '${o}' (code ${e}) for DOS (CP437)`);n[t]=s}t++}return n.subarray(0,t)},n.decode=function(e){const n=new Uint16Array(e.length);for(let t=0;t<e.length;t++){const r=e[t];n[t]=r>126?o[r-127]:r}return new TextDecoder("utf-16",{ignoreBOM:!0}).decode(n)};const t=Array.from("⌂ÇüéâäàåçêëèïîìÄÅÉæÆôöòûùÿÖÜ¢£¥₧ƒáíóúñÑªº¿⌐¬½¼¡«»░▒▓│┤╡╢╖╕╣║╗╝╜╛┐└┴┬├─┼╞╟╚╔╩╦╠═╬╧╨╤╥╙╘╒╓╫╪┘┌█▄▌▐▀αßΓπΣσµτΦΘΩδ∞φε∩≡±≥≤⌠⌡÷≈°∙·√ⁿ²■ "),r=Object.fromEntries(t.map(((e,n)=>[e,n+127]))),o=new Uint16Array(t.map((e=>e.charCodeAt(0))));new TextDecoder("utf-16")},6318:(e,n)=>{function t(e,n,t){n.lastIndex=0;const r=n.exec(e);return null===r?null:t(r)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){const n=[],t=[],r=[];let s=0,a=0;for(const u of e.split(/\r?\n/)){const e=n.length>0?n[n.length-1]:null,d=r.length>0?r[r.length-1]:null,f=t.length>0?t[t.length-1]:null,h=o(u);if(null===h){if(1===s||2===s){const e=i(u);if(null!==e){t.push({line:a,...e}),s=2;continue}}if(1===s||2===s){const e=l(u);if(null!==e){1===s?d.text+=e.text:2===s&&(f.message+=e.text);continue}}if(1===s||3===s){const n=c(u);null!==n&&(s=3,e.asm.push(n))}}else{const t={line:++a,...h};null!==d&&d.offset===h.offset?(r.push(t),e.lines[1]=a):(r.push(t),n.push({lines:[a,a],asm:[]})),s=1}}n.length>0&&""===r[n[n.length-1].lines[0]-1].text&&n.pop();return{lines:r,blocks:n,errors:t}};const r=/^ ([A-Z0-9]{4,4})   ([A-Z0-9]{4,4})    (.*)/,o=e=>t(e,r,(([e,n,t,r])=>({offset:Number(`0x${n}`),data:Number(`0x${t}`),text:r}))),s=/^ {16,16}( {0,61})\^\x07 (.*)/,i=e=>t(e,s,(([e,n,t])=>({column:n.length+1,message:t}))),a=/^ {16,16}(.*)/,l=e=>t(e,a,(([e,n])=>({text:n}))),u=/^ ([A-Z0-9]{4,4})    \*\*     (.*)/,c=e=>t(e,u,(([e,n,t])=>({offset:Number(`0x${n}`),text:t})))},3314:(e,n,t)=>{t.d(n,{Z:()=>s});var r=t(3645),o=t.n(r)()(!1);o.push([e.id,"html, body {\n    height: 100%;\n    margin: 0;\n}\n\nh1 {\n    margin: 0;\n    padding: 0;\n}\n\nh1, em, .dock-tab {\n    font-family: sans-serif;\n}\n\n#app {\n    display: grid;\n    grid-template-rows: auto 1fr;\n    min-height: 100%;\n}\n\n#root > .dock-layout {\n    min-height: 100%;\n}\n\n.sourceError {\n    text-decoration: underline red wavy;\n}\n\n.blockColor0 {\n    opacity: 0.5;\n    background: #c9e4de;\n}\n.blockColor1 {\n    opacity: 0.5;\n    background: #c6def1;\n}\n.blockColor2 {\n    opacity: 0.5;\n    background: #faedcb;\n}\n.blockColor3 {\n    opacity: 0.5;\n    background: #dbcdf0;\n}\n.blockColor4 {\n    opacity: 0.5;\n    background: #f7d9c4;\n}\n.blockColor5 {\n    opacity: 0.5;\n    background: #f2c6de;\n}\n.blockColor6 {\n    opacity: 0.5;\n    background: #e2cfc4;\n}\n.blockColor7 {\n    opacity: 0.5;\n    background: #f9c6c9;\n}\n.blockColor8 {\n    opacity: 0.5;\n    background: #d2d2cf;\n}\n.blockColor9 {\n    opacity: 0.5;\n    background: #e2e2df;\n}\n  \ndiv.hover-row.status-bar {\n    display: none !important;\n  }\n",""]);const s=o},4530:(e,n,t)=>{t.r(n),t.d(n,{default:()=>a});var r=t(3379),o=t.n(r),s=t(3314),i={insert:"head",singleton:!1};o()(s.Z,i);const a=s.Z.locals||{}},7086:e=>{e.exports=PropTypes},7363:e=>{e.exports=React},1533:e=>{e.exports=ReactDOM}},t={};function r(e){var o=t[e];if(void 0!==o)return o.exports;var s=t[e]={id:e,loaded:!1,exports:{}};return n[e].call(s.exports,s,s.exports,r),s.loaded=!0,s.exports}r.m=n,e=[],r.O=(n,t,o,s)=>{if(!t){var i=1/0;for(c=0;c<e.length;c++){for(var[t,o,s]=e[c],a=!0,l=0;l<t.length;l++)(!1&s||i>=s)&&Object.keys(r.O).every((e=>r.O[e](t[l])))?t.splice(l--,1):(a=!1,s<i&&(i=s));if(a){e.splice(c--,1);var u=o();void 0!==u&&(n=u)}}return n}s=s||0;for(var c=e.length;c>0&&e[c-1][2]>s;c--)e[c]=e[c-1];e[c]=[t,o,s]},r.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return r.d(n,{a:n}),n},r.d=(e,n)=>{for(var t in n)r.o(n,t)&&!r.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={179:0};r.O.j=n=>0===e[n];var n=(n,t)=>{var o,s,[i,a,l]=t,u=0;if(i.some((n=>0!==e[n]))){for(o in a)r.o(a,o)&&(r.m[o]=a[o]);if(l)var c=l(r)}for(n&&n(t);u<i.length;u++)s=i[u],r.o(e,s)&&e[s]&&e[s][0](),e[i[u]]=0;return r.O(c)},t=self.webpackChunkbasbolt=self.webpackChunkbasbolt||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))})(),r.O(void 0,[672],(()=>r(3057)));var o=r.O(void 0,[672],(()=>r(4530)));o=r.O(o)})();